## 쿠키, 캐시, 세션, Token

----

HTTP는 상태를 저장할 수 없는 프로토콜이다.매 번 요청-응답을 한 후에 그 페이지에 있는 정보들을 모두 날려버린다.하지만,웹사이트에서 사용자 정보 및 페이지 정보를 가지고 있어야 할 상황은 존재한다.그렇기 때문에 우리가 공부하는 쿠키,세션,캐시,Token이 HTTP가 저장하지 못하는 정보들을 저장해주는 기능을 제공해준다.

### 쿠키란?

> 사용자가 어떠한 웹사이트를 방문할 경우 그 사이트가 사용하고 있는 서버를 통해 인터넷 사용자의 컴퓨터에 설치되는 작은 기록 정보 파일을 일컫는다.

쿠키의 역할은 사용자가 해당 사이트를 다시 방문할 때 그 사이트에게 사용자에 대해 알려주는 것이다.쇼핑몰 사이트에서 로그인을 하지 않은 상태에서도 장바구니에 상품을 등록해논 후, 다시 쇼핑몰 사이트를 닫고 들어가도 장바구니에 여전히 상품이 등록해있는 경우가 있었을 것이다.그것이 *쿠키*의 역할이다.

쿠키를 이용하는 사용자는 기본 설정, 사용자 이름, 등록 상품 및 서비스를 저장할 수 있기 때문에 이를 기반으로 웹 사이트는 사용자가 좋아하는 컨텐츠, 자주 검색하는 키워드를 미리 알고 제공할 수 있다는 장점이 있다.그러나 쿠키안에 개인 데이터가 담겨 있을 경우, 악용될 가능성도 적지 않기에 보안에 취약하다는 단점도 있다.

#### 세션쿠키와 영구적쿠키

- 세션 쿠키: 쿠키에 만료일이 포함되어 있지 않은 경우,메모리에 저장되고 하드 디스크에 기록되지 않는다.브라우저를 다는 순간 영구적으로 손실된다.
- 영구적 쿠키: 쿠키에 만료일이 포함되어 있는 경우, 브라우저를 종료해도 하드 디스크에 저장된다.만료 시기가 되면 삭제된다.

### 캐시란?

> CS에서 데이터나 값을 미리 복사해놓는 임시 장소를 가리킨다. 캐시는 캐시의 접근 시간에 비해 원래 데이터를 접근하는 시간이 오래 걸리는 경우나 값을 다시 계산하는 시간을 절약하고 싶은 경우 사용한다.캐시에 데이터를 미리 복사해 놓으면 계산이나 접근시간 없이 더 빠른 속도로 데이터에 접근할 수 있다.

DB에 가서 데이터를 다시 가져오지않고 캐시에 저장된 데이터를 바로 가져올 수 있기에 시간을 절약할 수 있다.따라서 종종 변경되어야 할 데이터가 업데이트 되지 않을때가 있다면 캐시가 이유일 수도 있다.서버의 캐시클라우드라는 저장 공간에 사용자의 의지와 상관없이 자동 저장된다.웹 사이트에 처음 접속할 때보다 다시 접속했을 때 로딩 시간이 단축되는 이유도 캐시때문이다.

### 세션이란?

> 사용자 간 또는 컴퓨터 간의 대화를 위한 논리적 연결,프로세스들 사이에서 통신을 하기 위해 메세지 교환을 통해 서로를 인식한 이후부터 통신을 마칠 때까지의 시간

일정 시간동안 같은 사용자의 브라우저로부터 들어오는 일련의 요구를 하나의 상태로 보고 그 상태를 일정하게 유지시키는 기술, 일정시간이란 사용자가 웹 브라우저를 웹 서버에 접속한 시점으로부터 웹 브라우저를 종료함으로써 연결을 끝내는 시점을 의미한다.세션은 사용자의 요청에 따른 정보를 웹 서버가 세션 아이디 파일을 만들어 서비스가 돌아가고 있는 서버에 저장한느 것을 의미한다.사용자가 요청한 정보를 일정 시간동안 서버에 저장하는 것이다.

세션은 클라이언트마다 고유의 ID를 부여하여 세션 객체들마다 저장해둔 데이터를 이용한다.여기서 고유의 ID를 SessionID라고 하며 그 속성에 저장된 고유 식별자를 사용하여 클라이언트를 식별한다.세션ID는 쿠키에 저장되어 전송되거나 쿠키를 사용하지 않는 세션이 지정된 경우 URL에 포함되어 전송된다.만료된 세션ID를 사용하여 요청을 다시 만들면 요청과 함꼐 제동괸 세션ID를 사용하여 새 세션이 시작된다. 이런 이유로 웹사이트에 방문하여 계속 접속을 유지할 경우에 이전 접속 정보를 이용할 수 있는 방법으로 세션을 많이 사용한다.



### (토큰기반)Stateless서버 vs (세션기반)Stateful서버

Stateless서버: 상태정보를 저장하지 않으면, 서버는 클라이언트측에서 들어오는 요청으로만 작업을 처리하며 클라이언트의 상태를 유지하지 않는다.이렇게 상태를 유지하지 않는 경우에는 클라이언트-서버의 연결고리가 없기때문에 *확장성이 높아진다.*

Stateful서버: 클라이언트에게서 요청을 받을 때 마다, 클라이언트의 상태를 계속해서 유지하고 이 정보를 서비스제공에 이용한다.예로는 세션을 유지하는 웹서버, 여기서 이 세션은 서버 컴퓨터의 메모리에 담을 때도 있고 데이터베이스 시스템에 담을때도 있다.

### Token

> 소프트웨어 또는 하드웨어에서의 어떤 작업을 수행할 수 있는 권한을 나타내는 객체이다. 인증, 암호화 등 중요 작업에 많이 사용된다.

위의 세션의 문제점으로 나왔던 '서버의 확장성'을 토큰기반 인증을 하게되면 많은 문제가 해소된다.토큰 기반은 일단 무상태서버로 상태를 유지하지 않는다.세션에 유저의 인증 정보를 저장해놓지 않는다. 세션 대신에 토큰 기반 인증은 서버에서 토큰을 생성하여 클라이언트에게 signed토큰을 발급해준다.

이 때, 서버는 HTTP요청의 헤더에 토큰값을 포함시켜 전달한다.클라이언트는 발급받은 토큰을 저장해두고,서버에 요청할 때마다 함께(요청+토큰) 서버에 전달한다. 서버는 토큰을 검증하고 요청에 응답한다.

![image-20200323235237304](/Users/hongbeen/Library/Application Support/typora-user-images/image-20200323235237304.png)

이런 과정을 거치는 *토큰 기반 인증은 무상태 stateless이기 떄문에 확장성이 있다.* 또, 쿠키를 전달하지 않음으로 쿠키로 인한 보안에 대한 불안을 해소할 수 있다.또, 토큰을 사용하여 다른 서비스에서도 권한을 공유할 수 있다. 예를 들어, 잡코리아에서 naver, google계정 로그인이 가능해지는 경우이다.

